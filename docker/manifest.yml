---
# allows users to define custom registries
# this can also include GCR, NVCR, Heroku, etc.
repository:
  docker.io:
    user: HUB_USERNAME
    pwd: HUB_PASSWORD
    registry:
      model-server: docker.io/aarnphm/model-server
      yatai-service: docker.io/aarnphm/yatai-service

cuda_dependencies:
  11.3.1: &cuda11_3_1
    cudart: 11.3.109-1
    cudnn8: 8.2.0.53-1
    libcublas: 11.5.1.109-1
    libcurand: 10.2.4.109-1
    libcusparse: 11.6.0.109-1
    libcufft: 10.4.2.109-1
    libcusolver: 11.1.2.109-1

release_spec: &tmpl_spec
  templates_dir: ""
  base_image: ""
  add_to_tags: ""
  multistage_image: True
  header: |
    # syntax = docker/dockerfile:1.2
    #
    # ===========================================
    #
    # THIS IS A GENERATED DOCKERFILE DO NOT EDIT.
    #
    # ===========================================
  envars:
    - LANG=C.UTF-8
    - LC_ALL=C.UTF-8
    - PYTHONDONTWRITEBYTECODE=1
  cuda_prefix_url: ""
  cuda_requires: "cuda>=11.3 brand=tesla,driver>=418,driver<419 brand=tesla,driver>=440,driver<441 driver>=450"
  cuda:
    <<: *cuda11_3_1

tag_spec:
  fmt: "{release_type}-python{python_version}-{suffixes}"
  release_type:
  python_version:
  suffixes:

packages:
  model-server:
    devel: &default_specs
      - debian10
      - centos8
      - centos7
    runtime:
      - *default_specs
      - amazonlinux2
      - alpine3.14
    cudnn:
      - *default_specs
  yatai-service:
    runtime:
      - *default_specs

releases:
  debian10:
    <<: *tmpl_spec
    templates_dir: templates/debian
    base_image: debian:buster-slim
    add_to_tags: "slim"
    cuda_prefix_url: "ubuntu2004"

  centos8: &centos
    <<: *tmpl_spec
    templates_dir: templates/rhel
    base_image: centos:8
    add_to_tags: "centos8"
    cuda_prefix_url: "rhel8"

  centos7:
    <<: *centos
    base_image: centos:7
    add_to_tags: "centos7"
    cuda_prefix_url: "rhel7"

  amazonlinux2: &no_cuda
    <<: *tmpl_spec
    templates_dir: templates/rhel
    base_image: amazonlinux:2
    add_to_tags: "ami2"
    cuda_prefix_url:
    cuda_requires:
    cuda:

  alpine3.14:
    <<: *no_cuda
    templates_dir: templates/alpine
    base_image: alpine:3.14
    add_to_tags: "alpine3.14"