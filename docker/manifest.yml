---
header: |
  # syntax = docker/dockerfile:experimental
  #
  # ===========================================
  #
  # THIS IS A GENERATED DOCKERFILE DO NOT EDIT.
  #
  # ===========================================

releases:
  model-server:
    devel:
      spec:
        - "{devel-ubuntu}"
        - "{devel-centos}"
    runtime:
      spec:
        - "{ubuntu}"
        - "{centos}"
        - "{alpine}"
        - "{slim}"
        - "{amazonlinux2}"

dependencies:
  cuda:
    general: &cuda_cudnn
      - CUDA=11.3
      - CUDNN_MAJOR_VERSION=8
      - CUDNN_VERSION=8.2.0.53
    centos: &cuda_centos
      - CUBLAS_VERSION=11.5.1.109
      - CURAND_VERSION=10.2.4.109
      - CUSPARSE_VERSION=11.6.0.109
      - CUFFT_VERSION=10.4.2.109
      - CUSOLVER_VERSION=11.1.2.109

partials:
  ubuntu: &ubuntu_general_partials
    - env
    - ubuntu/base
    - conda
  ubuntu-gpu: &ubuntu_general_gpu_partials
    - env
    - ubuntu/base-nvidia
    - conda
  centos: &centos_general_partials
    - env
    - centos/base
    - conda
  centos-gpu: &centos_general_gpu_partials
    - env
    - centos/base-nvidia
    - conda


dist:
  ubuntu:
    - add_to_tags: "ubuntu20.04"
      dockerfile_name: "ubuntu"
      args: &ubuntu20_04_args
        - OS_VERSION=20.04
      partials: &ubuntu20_04_partials
        - *ubuntu_general_partials
        - bentoml/model-server

    - add_to_tags: "ubuntu20.04-gpu"
      dockerfile_name: "ubuntu-gpu"
      args:
        - *ubuntu20_04_args
        - *cuda_cudnn
      partials: &ubuntu20_04_gpu_partials
        - *ubuntu_general_gpu_partials
        - bentoml/model-server

    - add_to_tags: "ubuntu18.04"
      args: &ubuntu18_04_args
        - OS_VERSION=18.04
      partials:
        - *ubuntu20_04_partials

    - add_to_tags: "ubuntu18.04-gpu"
      args: &ubuntu18_04_gpu
        - *ubuntu18_04_args
        - *cuda_cudnn
      partials:
        - *ubuntu20_04_gpu_partials

  devel-ubuntu:
    - add_to_tags: "devel-ubuntu"
      dockerfile_name: "devel-ubuntu"
      args:
        - *ubuntu18_04_args
      partials:
        - *ubuntu_general_partials
        - shell
        - bentoml/devel-model-server

    - add_to_tags: "devel-ubuntu-gpu"
      dockerfile_name: "devel-ubuntu-gpu"
      args:
        - *ubuntu18_04_gpu
      partials:
        - *ubuntu_general_gpu_partials
        - shell
        - bentoml/devel-model-server

  centos:
    - add_to_tags: "centos8"
      dockerfile_name: "centos"
      args: &centos8_args
        - OS_VERSION=8
      partials: &centos8_partials
        - *centos_general_partials
        - bentoml/model-server

    - add_to_tags: "centos8-gpu"
      dockerfile_name: "centos-gpu"
      args: &centos8_gpu_args
        - *centos8_args
        - *cuda_cudnn
        - *cuda_centos
      partials: &centos8_gpu_partials
        - *centos_general_gpu_partials
        - bentoml/model-server

    - add_to_tags: "centos7"
      args: &centos7_args
        - OS_VERSION=7
      partials:
        - *centos8_partials

    - add_to_tags: "centos7-gpu"
      args:
        - *centos7_args
        - *cuda_cudnn
        - *cuda_centos
      partials:
        - *centos8_gpu_partials

  devel-centos:
    - add_to_tags: "devel-centos"
      dockerfile_name: "devel-centos"
      args:
        - *centos8_args
      partials:
        - *centos_general_partials
        - shell
        - bentoml/devel-model-server

    - add_to_tags: "devel-centos-gpu"
      dockerfile_name: "devel-centos-gpu"
      args:
        - *centos8_gpu_args
      partials:
        - *centos_general_gpu_partials
        - shell
        - bentoml/devel-model-server

  alpine:
    - add_to_tags: "alpine"
      args:
        - OS_VERSION=3.14
      partials:
        - env
        - alpine/base
        - conda
        - bentoml/model-server

  slim:
    - add_to_tags: "slim"
      dockerfile_name: "slim"
      args:
        - OS_VERSION=buster-slim
      partials:
        - ubuntu/base
        - env
        - conda
        - bentoml/model-server

  amazonlinux2:
    - add_to_tags: "ami2"
      dockerfile_name: "amazonlinux2"
      partials:
        - ubuntu/base
        - env
        - conda
        - bentoml/model-server