---
header: |
  # ===========================================
  #
  # THIS IS A GENERATED DOCKERFILE DO NOT EDIT.
  #
  # ===========================================

hub_repository:
  docker.io:
    only_if: HUB_PASSWORD
    user: HUB_USERNAME
    pwd: HUB_PASSWORD
    registry:
      model-server: bentoml/model-server
      yatai-service: bentoml/yatai-service

releases:
  model-server:
    devel:
      spec:
        - "{devel-ubuntu}"
        - "{devel-centos}"
    runtime:
      spec:
        - "{ubuntu}"
        - "{centos}"
        - "{slim}"
        - "{alpine}"
        - "{amazonlinux}"
  yatai-service:
    runtime:
      spec:
        - "{yatai-ubuntu}"
        - "{yatai-centos}"

dependencies:
  cuda:
    versioned: &cuda_cudnn
      - CUDA=11.3
      - CUDNN_MAJOR_VERSION=8
      - CUDNN_VERSION=8.2.0.53
    centos: &cuda_centos
      - CUBLAS_VERSION=11.5.1.109
      - CURAND_VERSION=10.2.4.109
      - CUSPARSE_VERSION=11.6.0.109
      - CUFFT_VERSION=10.4.2.109
      - CUSOLVER_VERSION=11.1.2.109

# ORDERS MATTER !!!
partials:
  ubuntu: &ubuntu_partials
    - env
    - ubuntu/base
  ubuntu-gpu: &ubuntu_gpu_partials
    - env
    - ubuntu/base-nvidia
  centos: &centos_partials
    - env
    - centos/base
  centos-gpu: &centos_gpu_partials
    - env
    - centos/base-nvidia
  bentoml: &bentoml_partials
    - conda
    - bentoml/model-server
  bentoml-devel: &bentoml_devel_partials
    - conda
    - shell
    - bentoml/devel-model-server


dist:
  ubuntu:
    - add_to_tags: "ubuntu20.04"
      dockerfile_name: "ubuntu"
      args: &ubuntu20_04_args
        - OS_VERSION=20.04
      partials: &ubuntu20_04_partials
        - *ubuntu_partials
        - conda
        - ubuntu/multi-conda
        - bentoml/model-server

    - add_to_tags: "ubuntu20.04-gpu"
      dockerfile_name: "ubuntu-gpu"
      args:
        - *ubuntu20_04_args
        - *cuda_cudnn
      partials: &ubuntu20_04_gpu_partials
        - *ubuntu_gpu_partials
        - conda
        - ubuntu/multi-conda
        - bentoml/model-server

    - add_to_tags: "ubuntu18.04"
      args: &ubuntu18_04_args
        - OS_VERSION=18.04
      partials:
        - *ubuntu20_04_partials

    - add_to_tags: "ubuntu18.04-gpu"
      args: &ubuntu18_04_gpu_args
        - *ubuntu18_04_args
        - *cuda_cudnn
      partials:
        - *ubuntu20_04_gpu_partials

  devel-ubuntu:
    - add_to_tags: "devel-ubuntu"
      dockerfile_name: "devel-ubuntu"
      args:
        - *ubuntu18_04_args
      partials:
        - *ubuntu_partials
        - *bentoml_devel_partials

    - add_to_tags: "devel-ubuntu-gpu"
      dockerfile_name: "devel-ubuntu-gpu"
      args:
        - *ubuntu18_04_gpu_args
      partials:
        - *ubuntu_gpu_partials
        - *bentoml_devel_partials

  centos:
    - add_to_tags: "centos8"
      dockerfile_name: "centos"
      args: &centos8_args
        - OS_VERSION=8
      partials: &centos8_partials
        - *centos_partials
        - *bentoml_partials

    - add_to_tags: "centos8-gpu"
      dockerfile_name: "centos-gpu"
      args: &centos8_gpu_args
        - *centos8_args
        - *cuda_cudnn
        - *cuda_centos
      partials: &centos8_gpu_partials
        - *centos_gpu_partials
        - *bentoml_partials

    - add_to_tags: "centos7"
      args: &centos7_args
        - OS_VERSION=7
      partials:
        - *centos8_partials

    - add_to_tags: "centos7-gpu"
      args:
        - *centos7_args
        - *cuda_cudnn
        - *cuda_centos
      partials:
        - *centos8_gpu_partials

  devel-centos:
    - add_to_tags: "devel-centos"
      dockerfile_name: "devel-centos"
      args:
        - *centos8_args
      partials:
        - *centos_partials
        - *bentoml_devel_partials

    - add_to_tags: "devel-centos-gpu"
      dockerfile_name: "devel-centos-gpu"
      args:
        - *centos8_gpu_args
      partials:
        - *centos_gpu_partials
        - *bentoml_devel_partials

  slim:
      - add_to_tags: "slim"
        dockerfile_name: "slim"
        args:
          - OS_VERSION=buster-slim
        partials:
          - env
          - debian/base
          - conda
          - debian/multi-conda
          - bentoml/model-server

  alpine:
    - add_to_tags: "alpine"
      dockerfile_name: "alpine"
      args:
        - OS_VERSION=3.14
      partials:
        - env
        - alpine/base
        - alpine/conda
        - bentoml/model-server

  amazonlinux:
    - add_to_tags: "ami2"
      dockerfile_name: "ami2"
      args:
        - OS_VERSION=2
      partials:
        - env
        - amazonlinux/base
        - amazonlinux/conda
        - bentoml/model-server

  yatai-ubuntu:
    - add_to_tags: "ubuntu18.04"
      dockerfile_name: "ubuntu"
      args:
        - OS_VERSION=18.04
      partials:
        - env
        - ubuntu/base
        - conda
        - bentoml/yatai-service

  yatai-centos:
    - add_to_tags: "centos8"
      dockerfile_name: "centos"
      args:
        - OS_VERSION=8
      partials:
        - env
        - centos/base
        - conda
        - bentoml/yatai-service